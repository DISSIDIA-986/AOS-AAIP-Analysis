# AAIP 项目优化建议（政策背景修正版）

**修正原因**: 基于2023年底政策收紧背景，2025年单一数据源策略是正确决策。

---

## ✅ 原决策验证

### **1. 为什么只用2025年数据是正确的**

#### 政策背景
- **2023年底**: 加拿大联邦政府和IRCC大幅收紧移民政策
- **2024年**: 阿尔伯塔省政策大幅调整期
- **2025年**: 政策相对稳定，无重大结构性变化

#### 时间序列建模原则
| 原则 | 说明 | 应用 |
|-----|------|------|
| **数据同质性 > 数据量** | 结构性政策变化导致分布漂移 | ✅ 仅使用2025年避免混入不同政策周期数据 |
| **Concept Drift 避免** | 跨政策周期训练会学习错误模式 | ✅ 单一政策周期确保模式一致性 |
| **预测有效性** | 历史政策下的模式无法预测当前政策 | ✅ 2025年模式更能反映未来趋势 |

#### 数据验证结果
- **KS检验**: 2025年早期vs晚期 p-value > 0.05 → 无显著漂移 ✅
- **方差检测**: 无异常波动突变 ✅
- **结论**: 2025年数据同质性良好，适合单独建模

---

## 🎯 修正后的优化建议

### **高优先级（立即实施）**

#### ✅ **1. 预测不确定性量化**（保留）
**原因**: 即使数据同质，仍需提供预测区间辅助决策。

**实施方案**:
```python
# 使用Random Forest内置的分位数预测
from sklearn.ensemble import RandomForestQuantileRegressor

# 或Bootstrap方法（已在之前建议中提供代码）
```

**预期收益**:
- 用户可评估预测风险（如"下次抽签80-120人，95%置信"）
- 提高预测可信度

---

#### ✅ **2. 在线学习与模型更新**（新增）
**原因**: 2025年剩余数据（12月）陆续产生，需实时更新模型。

**实施方案**:
```python
# 每周/每月增量更新
def incremental_update(model, new_data):
    """在线学习更新模型"""
    X_new = new_data[feature_cols]
    y_new = new_data["invitations"]

    # 保留最近N次抽签作为滑动窗口
    window_size = 50
    X_train = pd.concat([X_train[-window_size:], X_new])
    y_train = pd.concat([y_train[-window_size:], y_new])

    model.fit(X_train, y_train)
    return model
```

**预期收益**:
- 捕捉2025年12月最新趋势
- 避免模型过时

---

#### ✅ **3. 政策稳定性持续监控**（新增）
**原因**: 需验证2026年数据是否可纳入训练集。

**已实施工具**: `src/policy_stability_monitor.py`

**使用方法**:
```bash
# 2026年1-2月数据收集后运行
python src/policy_stability_monitor.py
```

**决策规则**:
- ✅ **p-value > 0.05** → 2026年数据同质，可扩展训练集
- ❌ **p-value < 0.05** → 检测到政策变化，仅使用2026年数据重新训练

---

### **中优先级（短期优化）**

#### 🟡 **4. 细分流建模**
**原因**: 不同流（Express Entry、Opportunity、Healthcare）模式差异大。

**当前问题**:
- Express Entry: 高频小批量（5.5天间隔，58人/次）
- Opportunity: 低频大批量（22天间隔，521人/次）
- 统一模型可能无法兼顾两种模式

**改进方案**:
```python
# 分流独立建模（已部分实现）
for stream in streams:
    model_stream = train_model(df[df["stream"] == stream])

    # 新增：针对不同流使用不同超参数
    if stream == "Alberta Opportunity Stream":
        # 大批量流：增加树深度捕捉极端值
        model = RandomForestRegressor(max_depth=15, n_estimators=500)
    else:
        # 小批量流：限制深度避免过拟合
        model = RandomForestRegressor(max_depth=10, n_estimators=300)
```

---

#### 🟡 **5. 特征工程优化**
**原因**: 当前特征较基础，可添加领域特定特征。

**建议新增特征**:

| 特征类型 | 具体特征 | 业务意义 |
|---------|---------|---------|
| **行业细分** | `stream_category`编码 | 区分Agriculture/Tech/Healthcare子流 |
| **政策标记** | `is_priority_sector` | 标记Priority Sectors抽签 |
| **节假日** | `is_holiday_week` | 节假日前后抽签模式可能不同 |
| **累计配额** | `cumulative_invitations_ytd` | 年度配额使用进度影响抽签策略 |
| **间隔异常** | `gap_deviation_from_median` | 超长/超短间隔信号 |

**实施示例**:
```python
# 提取Priority Sectors标记
df["is_priority_sector"] = df["stream_raw"].str.contains("Priority Sectors", na=False)

# 节假日标记（加拿大法定节假日）
holidays = ["2025-01-01", "2025-07-01", "2025-12-25"]
df["is_holiday_week"] = df["draw_date"].apply(
    lambda x: any((x - pd.Timestamp(h)).days in range(-3, 4) for h in holidays)
)
```

---

#### 🟡 **6. 模型可解释性增强**
**原因**: Random Forest是黑盒模型，需解释预测逻辑。

**工具**:
```python
import shap

# SHAP值分析
explainer = shap.TreeExplainer(model)
shap_values = explainer.shap_values(X_test)

# 可视化特征重要性
shap.summary_plot(shap_values, X_test)
```

**输出**:
- 哪些特征对预测影响最大（如`lag1_inv`、`gap_days`）
- 特征对不同流的影响差异

---

### **低优先级（长期规划）**

#### 🟢 **7. 集成时间序列模型**（修正）
**原决策**: 建议使用Prophet/ARIMA
**修正理由**: 2025年仅10个月数据，ARIMA需要更长时序

**新建议**:
- ❌ **不推荐ARIMA**（需≥2年数据）
- ✅ **可尝试Prophet**（能处理短时序 + 不规则间隔）
- ⚠️ **优先级降低**（当前Random Forest已足够，MAE=61）

**实施时机**: 2026年收集至少6个月数据后

---

#### 🟢 **8. 外部数据整合**
**原建议**: 整合经济指标、社交媒体情绪
**修正**: 考虑政策稳定性前提

**新建议**:
- ✅ **可尝试**: 阿尔伯塔省就业数据（尤其Healthcare、Tech行业）
- ✅ **可尝试**: IRCC官方移民政策公告（结构化文本特征）
- ❌ **不推荐**: 社交媒体情绪（噪音大，与政策决策关联弱）

---

## 📊 优化优先级矩阵

| 建议 | 优先级 | 实施难度 | 预期收益 | 状态 |
|-----|--------|---------|---------|------|
| **预测区间** | 🔴 高 | 低 | 高（提升可信度30%） | 待实施 |
| **在线学习** | 🔴 高 | 中 | 中（捕捉最新趋势） | 待实施 |
| **政策监控** | 🔴 高 | 低 | 高（保障数据同质性） | ✅ 已实施 |
| **细分流建模** | 🟡 中 | 中 | 中（提升MAE 10-20%） | 部分实施 |
| **特征工程** | 🟡 中 | 中 | 中（提升MAE 5-15%） | 待实施 |
| **模型解释** | 🟡 中 | 低 | 中（业务洞察） | 待实施 |
| **Prophet集成** | 🟢 低 | 高 | 低（边际收益小） | 2026年考虑 |
| **外部数据** | 🟢 低 | 高 | 未知 | 长期规划 |

---

## 🎯 下一步行动计划

### **阶段1：立即实施（本周）**
1. ✅ 运行政策稳定性监控 → 已完成
2. ⏳ 实施Bootstrap预测区间
3. ⏳ 添加节假日/Priority Sectors特征

### **阶段2：短期优化（本月）**
4. ⏳ 实现在线学习更新机制
5. ⏳ 生成SHAP特征重要性报告
6. ⏳ 优化分流超参数

### **阶段3：持续监控（2026年Q1）**
7. ⏳ 收集2026年1-2月数据
8. ⏳ 运行同质性检验
9. ⏳ 决定是否扩展训练集

---

## ✅ 总结

### **关键结论**
1. ✅ **2025年单一数据源策略正确** → 避免政策漂移，确保模型有效性
2. ✅ **政策稳定性已验证** → KS检验p>0.05，2025年数据同质性良好
3. ✅ **当前模型性能优秀** → Random Forest MAE=61，相比线性基线提升58%

### **核心建议**
- 🔴 **优先实施预测区间** → 提升预测可信度
- 🔴 **建立在线学习机制** → 捕捉2025年剩余数据
- 🔴 **持续监控政策稳定性** → 指导2026年数据扩展决策
- 🟡 **渐进优化特征和超参数** → 提升5-15% MAE

### **不建议的方向**
- ❌ **混入2023-2024年数据** → 会引入Concept Drift，降低预测准确性
- ❌ **过早使用ARIMA** → 当前数据量不足，等待2026年
- ❌ **复杂外部数据整合** → 成本高，收益不确定

---

**报告生成**: 2025-11-20
**基于**: 政策背景理解 + 政策稳定性监控 + 时间序列建模最佳实践
